{% extends "base.html" %}
{% load static %}

{% block title %}{{ event.name }}{% endblock %}

{% block content %}
<div class="center measure-very-wide pv4">
  <h2 class="font-title f3 f2-ns tc">{{ event.name }}</h2>

  {% if messages %}
      {% for message in messages %}
          <h3  {% if messages.tags %} class="{{ message.tags }}" {% endif %} style="color: #B78727;">{{ message }}</h3>
      {% endfor %}
  {% endif %}

  <p>{{ event.description }}</p>

  {% if rsvp %}
    <form action="{{ event.id }}/unrsvp" method="post">
    {% csrf_token %}
        <input type="submit" value="un-RSVP" />
    </form>
  {% else %}
    <form action="{{ event.id }}/rsvp" method="post">
    {% csrf_token %}
        <input type="submit" value="RSVP" />
    </form>
  {% endif %}

  <p><b>Location</b>: {{ event.location }}</p>
  <div id="date-and-time"></div>
  <script>
    function renderDateObj(dateStr) {
      // Transforms input such as 'Feb. 2, 2019, 10:36 p.m.' to a respective Date() object
      dateStr = dateStr.replace("p.m.", "pm").replace("a.m.", "am"); // new Date() wants "pm" not "p.m."
      return new Date(dateStr);
    }
    function trimDate(dateStr) {
      // Extracts just time from dateStr
      return dateStr.slice(dateStr.search(/\d+:\d\d [ap].m./));
    }

    var start = renderDateObj("{{ event.start_time }}");
    var end = renderDateObj("{{ event.end_time }}");
    if (start.getDate() === end.getDate() && start.getMonth() === end.getMonth()) {
      document.getElementById("date-and-time").innerHTML = "<p><b>Date and time</b>: {{ event.start_time }} to " + trimDate("{{ event.end_time }}") + "</p>";
    } else { // Event starts and ends on different days
      document.getElementById("date-and-time").innerHTML = "<p><b>Date and time</b>: {{ event.start_time }}; to {{ event.end_time }}";
    }
  </script>
</div>
{% endblock %}
